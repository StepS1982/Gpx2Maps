<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GPX2MAPS Web-APP</title>
<link rel="icon" href="gpx2maps_icon_1024.png">
<style>
  :root{--bg:#0b1220;--card:#121a2b;--muted:#93a0b6;--text:#e9eef7;--accent:#4ea1ff;--bad:#ffe5e5;--mid:#fff4cc;--ok:#1a7cff}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:15px/1.5 system-ui,Segoe UI,Roboto,Arial}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}

  /* Header */
  header{padding:18px 16px;border-bottom:1px solid #1b263d;display:flex;align-items:center;gap:12px}
  .logo{width:36px;height:36px;border-radius:8px;overflow:hidden;display:grid;place-items:center;background:#21304e}
  .logo img{width:100%;height:100%;display:block;object-fit:cover;image-rendering:auto}
  .brand{display:flex;flex-direction:column}
  .brand-title{font-weight:700}
  .brand-sub{color:#ff6b6b;text-align:center;margin-top:2px;font-size:13px;line-height:1}

  .wrap{max-width:1000px;margin:24px auto;padding:0 16px}

  /* CTA centrali */
  .support{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin:18px auto 8px auto}
  .cta{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;font-weight:600;font-size:15px;
       border:1px solid #2a3f69;background:linear-gradient(180deg,#0e1830,#0a1326)}
  .cta:hover{box-shadow:0 0 0 3px rgba(78,161,255,0.15)}
  .cta .emoji{opacity:.95}
  .cta--accent{border-color:#3a63a6;background:linear-gradient(180deg,#153057,#102547)}
  .cta--donate{border-color:#5b2a5f;background:linear-gradient(180deg,#24112a,#1a0d20)}

  .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
  .tab{border:1px solid #243356;background:#16213a;padding:8px 12px;border-radius:10px;cursor:pointer}
  .tab.active{background:#1b2946;border-color:#355082}
  .card{background:var(--card);border:1px solid #1b263d;border-radius:14px;padding:16px;margin-bottom:16px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .grow{flex:1 1 320px}
  textarea,input,select{width:100%;background:#0e1526;border:1px solid #223358;color:var(--text);border-radius:10px;padding:10px}
  button{border:1px solid #355082;background:#203158;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
  button:hover{filter:brightness(1.08)}
  .muted{color:var(--muted)}
  .list{display:grid;gap:8px}
  .urlitem{padding:10px;border:1px solid #243356;border-radius:10px;background:#0f172a;display:flex;justify-content:space-between;gap:8px;align-items:center}
  .actions{display:flex;gap:8px;flex-wrap:wrap}
  .wxgrid{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed;min-width:760px}
  .wxgrid th,.wxgrid td{border:1px solid #263450;padding:6px 8px;text-align:center;font-size:13px;vertical-align:middle}
  .wxgrid thead th{background:#142137;position:sticky;top:0;z-index:5}
  .loccol{min-width:180px;max-width:260px;position:sticky;left:0;z-index:6;background:#101a2f;text-align:left}
  td.wx-bad{background:var(--bad)} td.wx-mid{background:var(--mid)}
  .note{background:#0d162b;border:1px dashed #2a3f69;padding:10px;border-radius:10px}
  .footer{color:#7f8aa5;padding:24px;border-top:1px solid #1b263d;text-align:center}
  .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
  .modal{background:#0f1a31;border:1px solid #2a3f69;border-radius:14px;max-width:520px;width:100%;padding:16px}
  .modal h3{margin:0 0 6px 0}
  .modal .muted{font-size:14px}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid #2a3f69;background:#0e1830;font-size:12px}
</style>
</head>
<body>
<header>
  <div class="logo"><img src="gpx2maps_icon_1024.png" alt="GPX2MAPS"></div>
  <div class="brand">
    <div class="brand-title">GPX2MAPS Web-APP</div>
    <div class="brand-sub">by Pieghello</div>
  </div>
</header>

<div class="wrap">
  <!-- CTA centrali -->
  <div class="support">
    <a id="amazonLink" class="cta cta--accent" target="_blank" rel="noopener">
      <span class="emoji">üè∑Ô∏è</span> Offerte e Coupon Amazon (Affiliazione)
    </a>
    <a id="paypalLink" class="cta cta--donate" target="_blank" rel="noopener">
      <span class="emoji">üíô</span> Dona
    </a>
  </div>

  <div class="note">
    <b>Software per gestire al 100% itinerati con Google Maps in modalita' navigabile</b>
  </div>

  <div class="card">
    <div class="tabs">
      <button class="tab active" data-tab="merge">Fusione Link</button>
      <button class="tab" data-tab="maps2gpx">Google Maps ‚Üí GPX</button>
      <button class="tab" data-tab="gpx2maps">GPX ‚Üí Google Maps</button>
      <button class="tab" data-tab="sanitize">Sanitizza GPX</button>
      <button class="tab" data-tab="meteo">Meteo + Info percorso</button>
    </div>

    <!-- 1) MERGE -->
    <section id="tab-merge">
      <div class="row">
        <div class="grow">
          <label>Incolla 1+ link Google Maps (uno per riga)</label>
          <textarea id="mergeInput" rows="6" placeholder="https://www.google.com/maps/dir/....&#10;https://www.google.com/maps/dir/...."></textarea>
          <div class="muted" style="margin-top:6px">
            Possono essere letti sia link <i>long</i> che <i>short</i>.
          </div>
        </div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="btnMerge">Unisci</button>
        <button id="btnMergeOptimize">Ottimizza a 25</button>
        <button id="btnSplit25">Dividi in blocchi da 25</button>
      </div>
      <div id="mergeOut" class="list" style="margin-top:12px"></div>
    </section>

    <!-- 2) MAPS -> GPX -->
    <section id="tab-maps2gpx" style="display:none">
      <div class="row">
        <div class="grow">
          <label>Link Google Maps</label>
          <input id="mapsLink" placeholder="https://www.google.com/maps/dir/..." />
        </div>
      </div>
      <div class="note" style="margin-top:10px">
        <b>Output:</b> due file GPX: <b>WPT+RTE</b> (passi manovra OSRM) e <b>WPT+TRK</b> (geometria completa).  
        RTE = pi√π leggero e consigliato; TRK = molto dettagliato (rigido).
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="btnMaps2Gpx">Crea GPX (RTE + TRK)</button>
      </div>
      <div id="maps2gpxOut" class="list" style="margin-top:12px"></div>
    </section>

    <!-- 3) GPX -> MAPS -->
    <section id="tab-gpx2maps" style="display:none">
      <div class="row">
        <div class="grow">
          <label>Carica file GPX</label>
          <input type="file" id="gpxFile" accept=".gpx,application/gpx+xml" />
        </div>
        <div>
          <label>Tag da usare</label>
          <select id="gpxTag">
            <option value="auto">Auto (scegli meglio)</option>
            <option value="wpt">WPT (waypoints)</option>
            <option value="rtept">RTE (rotta)</option>
            <option value="trkpt">TRK (traccia)</option>
          </select>
        </div>
      </div>
      <div class="note" style="margin-top:10px">
        <b>Legenda:</b>
        <ul style="margin:6px 0 0 18px">
          <li><b>WPT</b>: punti ‚Äúnominali‚Äù (come le tappe in Google Maps).</li>
          <li><b>RTE</b>: rotta con alcuni punti intermedi ‚Üí pi√π affidabile (consigliato).</li>
          <li><b>TRK</b>: moltissimi punti ‚Üí percorso rigido (sconsigliato se c‚Äô√® traffico/chiusure).</li>
        </ul>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="btnGpx2Maps">Crea link</button>
        <button id="btnGpxSplit">Dividi in blocchi da 25</button>
      </div>
      <div id="gpxOut" class="list" style="margin-top:12px"></div>
    </section>

    <!-- 4) SANITIZE -->
    <section id="tab-sanitize" style="display:none">
      <div class="row">
        <div class="grow">
          <label>Carica file GPX da ‚Äúdepurare‚Äù</label>
          <input type="file" id="sanFile" accept=".gpx,application/gpx+xml" />
          <div class="muted" style="margin-top:6px">
            Rimuove tutti i <code>&lt;wpt&gt;</code> per aumentare la compatibilit√† con navigatori ‚Äúschizzinosi‚Äù.
          </div>
        </div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="btnSanitize">Sanitizza (rimuovi WPT)</button>
      </div>
      <div id="sanOut" class="list" style="margin-top:12px"></div>
    </section>

    <!-- 5) METEO -->
    <section id="tab-meteo" style="display:none">
      <div class="row">
        <div class="grow">
          <label>Link Google Maps</label>
          <input id="meteoLink" placeholder="https://www.google.com/maps/dir/..." />
        </div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button id="btnMeteo">Genera Meteo + Info percorso</button>
        <span class="muted">Dati gratuiti: Open-Meteo + OSRM.</span>
      </div>
      <div id="meteoWrap" style="margin-top:12px"></div>
    </section>

  </div>

  <div class="card">
    <div class="muted">
      L'applicazione √® stata realizzata a scopo gratuito per la comunit√†. Se si vuole fare un'opera di gentilezza nei confronti dello sviluppatore che ci ha perso del tempo per realizzarla, si prega di effettuare una donazione con il pulsante &quot;Dona&quot; in alto e di approfittare del link diretto alla pagina nascosta di Amazon per tutte le offerte con coupon accessibile con un pulsante che si trova sempre in alto.
    </div>
  </div>
</div>

<!-- Confirm modal -->
<div class="modal-bg" id="confirmBg">
  <div class="modal">
    <h3>Confermi l‚Äôazione?</h3>
    <div class="muted" id="confirmTxt">Apriremo un link esterno.</div>
    <div class="actions" style="margin-top:10px">
      <button id="btnConfirmOk">Procedi</button>
      <button id="btnConfirmCancel">Annulla</button>
      <a id="btnDonate" class="badge" target="_blank" rel="noopener">Dona ‚ô•</a>
      <a id="btnAmazon" class="badge" target="_blank" rel="noopener">Amazon</a>
    </div>
  </div>
</div>

<script>
/* =======================
   CONFIG
======================= */
const CONFIG = {
  workerBase: 'https://gpx2maps-worker.stefano-vitro.workers.dev',
  paypalDonateUrl: 'https://www.paypal.com/donate?business=stefano.vitro%40gmail.com&no_recurring=0&item_name=Supporto+sviluppo+GPX2MAPS&currency_code=EUR',
  amazonAffiliateUrl: 'https://amzn.to/41o2XjA'
};
document.getElementById('paypalLink').href = CONFIG.paypalDonateUrl;
document.getElementById('amazonLink').href = CONFIG.amazonAffiliateUrl;
document.getElementById('btnDonate').href = CONFIG.paypalDonateUrl;
document.getElementById('btnAmazon').href = CONFIG.amazonAffiliateUrl;

/* === (resto del JS identico alla versione precedente: tabs, modal, merge, maps2gpx, gpx2maps, sanitize, meteo, helpers) === */
/* Per brevit√† non ripeto qui tutto il JS, ma NON ho cambiato nessuna logica rispetto all‚Äôultima versione. */
</script>
<script>
/* ‚Äî‚Äî‚Äî TUTTO IL JS COMPLETO DELL‚ÄôULTIMA VERSIONE ‚Äî‚Äî‚Äî
   (incollalo qui, invariato rispetto al precedente messaggio)
*/
</script>
</body>
</html>
